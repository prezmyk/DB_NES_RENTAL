<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="patron_ck_tr" directorySegmentName="seg_0" id="0F4B4264-8181-5256-1057-F36F5E3D561E">
<createdBy>PzK</createdBy>
<createdTime>2022-07-19 08:41:24 UTC</createdTime>
<ownerDesignName>nes_rental_shop</ownerDesignName>
<actions>INSERT, UPDATE</actions>
<body><![CDATA[DECLARE
PRAGMA AUTONOMOUS_TRANSACTION;
TYPE cust_typ IS TABLE OF CHAR(12) INDEX BY PLS_INTEGER;
                collection_cust_typ cust_typ := cust_typ();
BEGIN 
SELECT customer_id 
BULK COLLECT INTO collection_cust_typ 
FROM customers 
WHERE months_between(sysdate,birth_date)/12 > 18;

FOR i IN collection_cust_typ.first .. collection_cust_typ.last
	LOOP
		IF :new.patron_id IN (collection_cust_typ(i)) OR :new.patron_id IS NULL
            THEN
                COMMIT;
            ELSE
               RAISE_APPLICATION_ERROR(-20001, 'Patron has to be 18 years old and more or incorrect CUSTOMER_ID'); 
           END IF;            
	END LOOP;      
END;]]></body>
<triggerTime>BEFORE</triggerTime>
<table>941CD3AD-604B-26E1-5890-35433799F8F2</table>
</TriggerOraclev10g>